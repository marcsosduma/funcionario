<!DOCTYPE html>
<html layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8"/>
    <script src="/js/jquery.mask.min.js"></script>
    <script src="/js/cpf.js"></script>
    <script th:inline="none">
        $(function () {
            $('#cpf').mask('000.000.000-00', { reverse: true });

            $('#cpf').on('blur', function () {
                const valor = $(this).val().trim();
                if (valor === '') {
                    this.setCustomValidity('');
                    $(this).removeClass('is-invalid is-valid');
                    return;                
                }
                const ok = validarCPF(valor);
                this.setCustomValidity(ok ? '' : 'CPF inválido');
                $(this).toggleClass('is-invalid', !ok);
                $(this).toggleClass('is-valid', ok);
            });

            $('#area').on('change', function () {
                const areaId = $(this).val();
                const $subarea = $('#subarea');

                $subarea.empty().append('<option value="">Selecione</option>');
                url = (areaId)?'/pessoas/subareas/' + areaId:'/pessoas/subareas';
                $.getJSON(url, function (data) {
                    $.each(data, function (i, sub) {
                        $subarea.append($('<option>', {
                            value: sub.codigo,
                            text: sub.descricao
                        }));
                    });
                });                
            });
        });

        function limparFormulario() {
            const form = $('#pesquisar form')[0];
            form.reset();                         
            $(form).find('.is-invalid, .is-valid').removeClass('is-invalid is-valid');
            $(form).find('inputm, select, textarea').val('');
                form.querySelectorAll('input, select, textarea').forEach(el => {
                el.setCustomValidity('');
            });
            $('#nome').focus();
        }
    </script>
</head>
<body>
    <section class="layout-content" layout:fragment="corpo">

        <nav class="navbar navbar-expand-md bg-light">
            <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <i class="oi oi-caret-right"></i>
                        <span>Pesquisar Pessoas</span>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="container" id="pesquisar">

            <div th:replace="~{fragments/alert}"></div>

            <form th:action="@{/pessoas/pesquisar}" th:object="${pessoa}">

                <div class="form-row">
                    <!-- Nome -->
                    <div class="form-group col-md-6">
                        <label for="nome">Nome</label>
                        <input type="text" class="form-control" id="nome" placeholder="Nome" 
                               autofocus th:field="*{nome}" />
                    </div>

                    <!-- Somente Assessores -->
                    <div class="form-group col-md-6">
                        <div class="form-check mt-4">
                            <input type="checkbox" class="form-check-input" id="soAssessores" th:field="*{soAssessores}" />
                            <label class="form-check-label" for="soAssessores">Somente Assessores</label>
                        </div>
                    </div>

                    <!-- CPF -->
                    <div class="form-group col-md-6">
                        <label for="cpf">CPF</label>
                        <input id="cpf" name="cpf" th:field="*{cpf}"
                                class="form-control"
                                placeholder="000.000.000-00"
                                autocomplete="off"
                                pattern="^\d{3}\.\d{3}\.\d{3}-\d{2}$">
                        <div class="invalid-feedback">CPF inválido.</div>
                        <div class="valid-feedback">CPF válido.</div>
                        <div th:if="${#fields.hasErrors('cpf')}" class="text-danger" th:errors="*{cpf}">Erro</div>
                    </div>

                    <!-- Palavra-chave -->
					<div class="form-group col-md-12">
						<label for="palavraChave1">Palavra-chave</label>
						<div class="d-flex gap-2">
							<input type="text" class="form-control" id="palavraChave1" placeholder="Palavra-chave 1" th:field="*{palavraChave1}" />
							<input type="text" class="form-control" id="palavraChave2" placeholder="Palavra-chave 2" th:field="*{palavraChave2}" />
							<input type="text" class="form-control" id="palavraChave3" placeholder="Palavra-chave 3" th:field="*{palavraChave3}" />
							<select name="criterio" class="form-control" th:field="*{criterio}">
								<option value="QUALQUER">Qualquer Palavra-chave</option>
								<option value="TODAS">Todas Palavras-chave</option>
								<option value="MESMA">Todas na mesma Palavra-chave</option>
							</select>
						</div>
					</div>

                    <!-- Área -->
                    <div class="form-group col-md-4">
                        <label for="area">Área</label>
                        <select id="area" class="form-control" th:field="*{area}">
                            <option value="">Selecione</option>
                            <option th:each="a : ${areas}" th:value="${a.codigo}" th:text="${a.descricao}">Administração</option>
                        </select>
                    </div>

                    <!-- Subárea -->
                    <div class="form-group col-md-4">
                        <label for="subarea">Subárea</label>
                        <select id="subarea" class="form-control" th:field="*{subarea}">
                            <option value="">Selecione</option>
                            <option th:each="s : ${subareas}" th:value="${s.codigo}" th:text="${s.descricao}">Administração pública</option>
                        </select>
                    </div>

                    <!-- Vínculo Institucional -->
                    <div class="form-group col-md-6">
                        <label for="unidade">Vínculo Institucional</label>
                        <input type="text" class="form-control" id="unidade" placeholder="Vínculo Institucional" th:field="*{unidade}" />
                    </div>

                    <!-- Ordenação -->
					<div class="form-group col-md-12">
						<label>Ordenação</label>
						<div>
							<div class="form-check form-check-inline">
								<input type="radio" class="form-check-input" id="ordAlfabetica" th:field="*{ordenacao}" value="ALFA" />
								<label class="form-check-label" for="ordAlfabetica">Alfabética</label>
							</div>
							<div class="form-check form-check-inline">
								<input type="radio" class="form-check-input" id="ordOcupacao" th:field="*{ordenacao}" value="OCUPACAO" />
								<label class="form-check-label" for="ordOcupacao">Ocupação</label>
							</div>
							<div class="form-check form-check-inline">
								<input type="radio" class="form-check-input" id="ordTempo" th:field="*{ordenacao}" value="TEMPO" />
								<label class="form-check-label" for="ordTempo">Tempo de Devolução</label>
							</div>
						</div>
					</div>
                </div>

                <div class="d-flex justify-content-between mt-2">
					<button type="button" class="btn btn-secondary btn-sm" onclick="limparFormulario()">Limpar</button>
					<button type="submit" class="btn btn-primary btn-sm">Buscar</button>
				</div>
            </form>
        </div>
    </section>
</body>
</html>
